var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},h5game;!function(t){var e=function(t){function e(){var i=t.call(this)||this;return i._localId=0,i._entityId=0,i._data=null,i._localId=e._AUTO_LOCAL_ID++,e._AUTO_LOCAL_ID>e._AUTO_LOCAL_MAX_ID&&(e._AUTO_LOCAL_ID=1),i}return __extends(e,t),Object.defineProperty(e.prototype,"localId",{get:function(){return this._localId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityId",{get:function(){return this._entityId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityType",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.init=function(t,e){this._data=t,this._mapLayer=e},e.prototype.release=function(){this._data=null,this._mapLayer=null},e.prototype.update=function(t){},e.prototype.$setY=function(e){var i=t.prototype.$setY.call(this,e);return this.zorder=e,i},e._AUTO_LOCAL_ID=1,e._AUTO_LOCAL_MAX_ID=1e5,e}(egret.DisplayObjectContainer);t.Entity=e,__reflect(e.prototype,"h5game.Entity")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._actionState=0,i._dir=t.ActorActionState.AAS_STANDFRONT,i._moveTarPos=[0,0],i._moveSpeed=[0,0],i._moving=!1,i._speed=200,i._spriteScale=1,i._hp=0,i._maxHp=1,i._mp=0,i._maxMp=1,i}return __extends(i,e),Object.defineProperty(i.prototype,"hp",{get:function(){return this._hp},set:function(t){this._hp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mp",{get:function(){return this._mp},set:function(t){this._mp=t},enumerable:!0,configurable:!0}),i.prototype.getName=function(){return this._name},i.prototype.init=function(t,i){e.prototype.init.call(this,t,i)},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.update=function(t){e.prototype.update.call(this,t),this.updateMove(t)},i.prototype.initSprite=function(){},i.prototype.initNameLabel=function(){this._nameLabel=new eui.Label(this.getName()),this._nameLabel.width=100,this._nameLabel.height=20,this._nameLabel.textAlign="center",this._nameLabel.size=13,this._nameLabel.stroke=1,this._nameLabel.strokeColor=3355443,this._nameLabel.anchorOffsetX=this._nameLabel.width/2,this._nameLabel.verticalAlign="bottom",this._nameLabel.y=-130,this.addChild(this._nameLabel)},i.prototype.initHpBar=function(){this._hpBar=new eui.ProgressBar,this._hpBar.width=60,this._hpBar.height=10,this._hpBar.minimum=0,this._hpBar.maximum=this._maxHp,this._hpBar.value=this._hp,this._hpBar.anchorOffsetX=this._hpBar.width/2,this._hpBar.y=-170,this.addChild(this._hpBar)},i.prototype.refreshHpBar=function(){this._hpBar.minimum=0,this._hpBar.maximum=this._maxHp,this._hpBar.value=this._hp},i.prototype.initMpBar=function(){this._mpBar=new eui.ProgressBar,this._mpBar.width=60,this._mpBar.height=10,this._mpBar.minimum=0,this._mpBar.maximum=this._maxMp,this._mpBar.value=this._mp,this._mpBar.anchorOffsetX=this._mpBar.width/2,this._mpBar.y=-150,this.addChild(this._mpBar)},i.prototype.refreshMpBar=function(){this._mpBar.minimum=0,this._mpBar.maximum=this._maxMp,this._mpBar.value=this._mp},i.prototype.setDir=function(t){this._dir=t},i.prototype.setActionState=function(e){this._actionState!=e&&(this._actionState=e,this._sprite.gotoAndPlay(t.EntityUtil.actionState2Str(e),-1))},i.prototype.standAct=function(){var e=0;e=this._dir==t.ActorDir.AD_EASTSOUTH||this._dir==t.ActorDir.AD_WESTSOUTH?t.ActorActionState.AAS_STANDFRONT:t.ActorActionState.AAS_STANDBACK,this.setActionState(e)},i.prototype.runAct=function(){var e=0;e=this._dir==t.ActorDir.AD_EASTSOUTH||this._dir==t.ActorDir.AD_WESTSOUTH?t.ActorActionState.AAS_RUNFRONT:t.ActorActionState.AAS_RUNBACK,this.setActionState(e)},i.prototype.attackAct=function(){var e=0;e=this._dir==t.ActorDir.AD_EASTSOUTH||this._dir==t.ActorDir.AD_WESTSOUTH?t.ActorActionState.AAS_ATTACKFRONT:t.ActorActionState.AAS_ATTACKBACK,this.setActionState(e)},i.prototype.moveTo=function(e,i){if(this.x==e&&this.y==i)return void this.stopMove();this._moving=!0,this._moveTarPos[0]=e,this._moveTarPos[1]=i;var r=t.VectorUtil.calcDir(this.x,this.y,e,i);this._moveSpeed[0]=r[0]*this._speed,this._moveSpeed[1]=r[1]*this._speed,this.adjustDir(e,i),this.runAct()},i.prototype.clearMoveData=function(){this._moving=!1,this._moveTarPos[0]=0,this._moveTarPos[1]=0,this._moveSpeed[0]=0,this._moveSpeed[1]=0},i.prototype.stopMove=function(){this.clearMoveData(),this.standAct()},i.prototype.updateMove=function(e){if(this._moving){this.x+=this._moveSpeed[0]*e,this.y+=this._moveSpeed[1]*e;var i=t.VectorUtil.calcLength(this._moveTarPos[0]-this.x,this._moveTarPos[1]-this.y);i<this._speed*e&&(this.x=this._moveTarPos[0],this.y=this._moveTarPos[1],this.clearMoveData(),this.standAct())}},i.prototype.setFlipX=function(t){this._sprite.scaleX=t?-this._spriteScale:this._spriteScale},i.prototype.adjustDir=function(e,i){var r=e-this.x,n=i-this.y;(0!=r||0!=n)&&(r>0?(0>n?this._dir=t.ActorDir.AD_EASTNORTH:this._dir=t.ActorDir.AD_EASTSOUTH,this.setFlipX(!1)):(0>n?this._dir=t.ActorDir.AD_WESTNORTH:this._dir=t.ActorDir.AD_WESTSOUTH,this.setFlipX(!0)))},i.prototype.execSkill=function(e,i){this.attackAct();var r=i.result;if(r.result==t.AttackResult.SUCCESS){this._mapLayer.notify(t.IMapCmdN.IMCN_CreateNum,[this.x,this.y,0,r.damage]);var n=this._mapLayer.query(t.IMapCmdQ.IMCQ_GetActor,[i.target]);n.hp-=r.damage,n.refreshHpBar()}},i}(t.Entity);t.Actor=e,__reflect(e.prototype,"h5game.Actor")}(h5game||(h5game={}));var h5game;!function(t){var e;!function(t){t[t.ET_PLAYER=1]="ET_PLAYER",t[t.ET_MONSTER=2]="ET_MONSTER",t[t.ET_NPC=3]="ET_NPC"}(e=t.EntityType||(t.EntityType={}));var i;!function(t){t[t.AAS_STANDFRONT=1]="AAS_STANDFRONT",t[t.AAS_STANDBACK=2]="AAS_STANDBACK",t[t.AAS_RUNFRONT=3]="AAS_RUNFRONT",t[t.AAS_RUNBACK=4]="AAS_RUNBACK",t[t.AAS_ATTACKFRONT=5]="AAS_ATTACKFRONT",t[t.AAS_ATTACKBACK=6]="AAS_ATTACKBACK"}(i=t.ActorActionState||(t.ActorActionState={}));var r;!function(t){t[t.AD_EASTSOUTH=1]="AD_EASTSOUTH",t[t.AD_EASTNORTH=2]="AD_EASTNORTH",t[t.AD_WESTSOUTH=3]="AD_WESTSOUTH",t[t.AD_WESTNORTH=4]="AD_WESTNORTH"}(r=t.ActorDir||(t.ActorDir={}));var n;!function(t){t[t.SUCCESS=1]="SUCCESS",t[t.KILLED=2]="KILLED",t[t.MISS=3]="MISS",t[t.NOT_IN_RANGE=4]="NOT_IN_RANGE",t[t.NO_ENOUGH_MP=5]="NO_ENOUGH_MP",t[t.NOT_COOLDOWN=6]="NOT_COOLDOWN",t[t.ATTACKER_CONFUSED=7]="ATTACKER_CONFUSED"}(n=t.AttackResult||(t.AttackResult={}))}(h5game||(h5game={}));var h5game;!function(t){var e=function(){function t(){}return t.getMCFtry=function(){return egret.getImplementation("IMCFtry")},t.getNetMsgHdlr=function(){return egret.getImplementation("INetMsgHdlr")},t}();t.EntityProxy=e,__reflect(e.prototype,"h5game.EntityProxy")}(h5game||(h5game={}));var h5game;!function(t){var e=function(){function e(){}return e.actionState2Str=function(e){return e==t.ActorActionState.AAS_STANDFRONT?"standfront":e==t.ActorActionState.AAS_STANDBACK?"standback":e==t.ActorActionState.AAS_RUNFRONT?"runfront":e==t.ActorActionState.AAS_RUNBACK?"runback":e==t.ActorActionState.AAS_ATTACKFRONT?"attackfront":e==t.ActorActionState.AAS_ATTACKBACK?"attackback":"standfront"},e}();t.EntityUtil=e,__reflect(e.prototype,"h5game.EntityUtil")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"entityType",{get:function(){return t.EntityType.ET_MONSTER},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i),this._entityId=t.entityId,this._name="mon10001",this._hp=t.hp,this._maxHp=t.maxHp,this._speed=t.walkSpeed,this.x=t.x,this.y=t.y,this.initSprite(),this.initNameLabel(),this.initHpBar(),this.standAct()},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.initSprite=function(){this._sprite=t.EntityProxy.getMCFtry().create("monster_10001"),this.addChild(this._sprite)},i}(t.Actor);t.Monster=e,__reflect(e.prototype,"h5game.Monster")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"entityType",{get:function(){return t.EntityType.ET_NPC},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i),this._entityId=t.entityId,this._name="npc10001",this.x=t.x,this.y=t.y,this.initSprite(),this.standAct()},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.initSprite=function(){this._sprite=t.EntityProxy.getMCFtry().create("npc_10001"),this.addChild(this._sprite)},i}(t.Actor);t.Npc=e,__reflect(e.prototype,"h5game.Npc")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._mainPlayer=!1,t}return __extends(i,e),Object.defineProperty(i.prototype,"entityType",{get:function(){return t.EntityType.ET_PLAYER},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i),this._entityId=t.entityId,this._name=t.name,this._hp=t.hp,this._maxHp=t.maxHp,this._mp=t.mp,this._maxMp=t.maxMp,this._speed=t.walkSpeed,this.x=t.x,this.y=t.y,this.initSprite(),this.initNameLabel(),this.initHpBar(),this.initMpBar(),this.standAct()},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.initSprite=function(){this._sprite=t.EntityProxy.getMCFtry().create("player_10001"),this.addChild(this._sprite)},Object.defineProperty(i.prototype,"mainPlayer",{get:function(){return this._mainPlayer},set:function(t){this._mainPlayer=t},enumerable:!0,configurable:!0}),i.prototype.moveTo=function(i,r){e.prototype.moveTo.call(this,i,r),this.mainPlayer&&t.EntityProxy.getNetMsgHdlr().requestMsg(t.INetMsgReq.INMR_MOVE,[{x:this.x,y:this.y},{x:i,y:r}],null)},i}(t.Actor);t.Player=e,__reflect(e.prototype,"h5game.Player")}(h5game||(h5game={}));