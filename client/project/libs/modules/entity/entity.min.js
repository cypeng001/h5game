var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},h5game;!function(t){var e=function(t){function e(){var i=t.call(this)||this;return i._localId=0,i._entityId=0,i._data=null,i._localId=e._AUTO_LOCAL_ID++,e._AUTO_LOCAL_ID>e._AUTO_LOCAL_MAX_ID&&(e._AUTO_LOCAL_ID=1),i}return __extends(e,t),Object.defineProperty(e.prototype,"localId",{get:function(){return this._localId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityId",{get:function(){return this._entityId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityType",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.init=function(t,e){this._data=t,this._mapLayer=e},e.prototype.release=function(){this._data=null,this._mapLayer=null},e.prototype.update=function(t){},e.prototype.$setY=function(e){var i=t.prototype.$setY.call(this,e);return this.zorder=e,i},e._AUTO_LOCAL_ID=1,e._AUTO_LOCAL_MAX_ID=1e5,e}(egret.DisplayObjectContainer);t.Entity=e,__reflect(e.prototype,"h5game.Entity")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._actionState=0,i._dir=t.ActorActionState.AAS_STANDFRONT,i._moveTarPos=[0,0],i._moveSpeed=[0,0],i._moving=!1,i._speed=200,i._spriteScale=1,i._hp=0,i._maxHp=1,i._mp=0,i._maxMp=1,i._mainPlayer=!1,i._spActs=[],i._actorSt=null,i._actorSt=new t.ActorState(i),i}return __extends(i,e),Object.defineProperty(i.prototype,"hp",{get:function(){return this._hp},set:function(t){this._hp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxHp",{get:function(){return this._maxHp},set:function(t){this._maxHp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mp",{get:function(){return this._mp},set:function(t){this._mp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxMp",{get:function(){return this._maxMp},set:function(t){this._maxMp=t},enumerable:!0,configurable:!0}),i.prototype.getName=function(){return this._name},Object.defineProperty(i.prototype,"mainPlayer",{get:function(){return this._mainPlayer},set:function(t){this._mainPlayer=t},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i)},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.update=function(t){e.prototype.update.call(this,t),this.updateMove(t),this.updateSpAct(t),this._actorSt.update(t)},i.prototype.initSprite=function(){},i.prototype.initNameLabel=function(){this._nameLabel=new eui.Label(this.getName()),this._nameLabel.width=100,this._nameLabel.height=20,this._nameLabel.textAlign="center",this._nameLabel.size=13,this._nameLabel.stroke=1,this._nameLabel.strokeColor=3355443,this._nameLabel.anchorOffsetX=this._nameLabel.width/2,this._nameLabel.verticalAlign="bottom",this._nameLabel.y=-130,this.addChild(this._nameLabel)},i.prototype.initHpBar=function(){this._hpBar=new eui.ProgressBar,this._hpBar.skinName="resource/custom_skins/progressbar/actorProgressBarSkin1.exml",this._hpBar.width=64,this._hpBar.height=12,this._hpBar.minimum=0,this._hpBar.maximum=this._maxHp,this._hpBar.value=this._hp,this._hpBar.anchorOffsetX=this._hpBar.width/2,this._hpBar.y=-140,this.addChild(this._hpBar)},i.prototype.refreshHpBar=function(){this._hpBar.minimum=0,this._hpBar.maximum=this._maxHp,this._hpBar.value=this._hp},i.prototype.initMpBar=function(){this._mpBar=new eui.ProgressBar,this._mpBar.width=60,this._mpBar.height=10,this._mpBar.minimum=0,this._mpBar.maximum=this._maxMp,this._mpBar.value=this._mp,this._mpBar.anchorOffsetX=this._mpBar.width/2,this._mpBar.y=-150,this._mpBar.visible=!1,this.addChild(this._mpBar)},i.prototype.refreshMpBar=function(){this._mpBar.minimum=0,this._mpBar.maximum=this._maxMp,this._mpBar.value=this._mp},i.prototype.setDir=function(t){this._dir=t},i.prototype._setActionState=function(e,i){var r=i?-1:1;this._sprite.playAnimation(t.EntityUtil.actionState2Str(e),r);var o=this.getActStFrmRate(e);o>0&&(this._sprite.frameRate=o)},i.prototype.setActionState=function(t,e){this._actionState!=t&&(this._actionState=t,this._setActionState(t,e))},i.prototype.resetActionState=function(t,e){this._actionState=t,this._setActionState(t,e)},i.prototype.getActStFrmRate=function(e){return t.EntityUtil.actStFrmRate(this.entityType,e)},i.prototype.getActFrmCount=function(e){return this._sprite.getFrameCount(t.EntityUtil.actionState2Str(e))},i.prototype.getCurActFrmCount=function(){return this._sprite.getCurFrmCount()},i.prototype.getActStTime=function(t){var e=this.getActStFrmRate(t),i=this.getActFrmCount(t);return i/e},i.prototype.getCurActStTime=function(){var t=this.getActStFrmRate(this._actionState),e=this.getCurActFrmCount();return e/t},i.prototype.standAct=function(){var e=0;e=this._dir==t.ActorDir.AD_EASTSOUTH||this._dir==t.ActorDir.AD_WESTSOUTH?t.ActorActionState.AAS_STANDFRONT:t.ActorActionState.AAS_STANDBACK,this.setActionState(e,!0)},i.prototype.runAct=function(){var e=0;e=this._dir==t.ActorDir.AD_EASTSOUTH||this._dir==t.ActorDir.AD_WESTSOUTH?t.ActorActionState.AAS_RUNFRONT:t.ActorActionState.AAS_RUNBACK,this.setActionState(e,!0)},i.prototype.attackAct=function(){var e=0;e=this._dir==t.ActorDir.AD_EASTSOUTH||this._dir==t.ActorDir.AD_WESTSOUTH?t.ActorActionState.AAS_ATTACKFRONT:t.ActorActionState.AAS_ATTACKBACK,this.setActionState(e,!1)},i.prototype.moveTo=function(e,i){if(this.x==e&&this.y==i)return void this.stopMove();this._moving=!0,this._moveTarPos[0]=e,this._moveTarPos[1]=i;var r=t.VectorUtil.calcDir(this.x,this.y,e,i);this._moveSpeed[0]=r[0]*this._speed,this._moveSpeed[1]=r[1]*this._speed,this.adjustDir(e,i),this.runAct()},i.prototype.clearMoveData=function(){this._moving=!1,this._moveTarPos[0]=0,this._moveTarPos[1]=0,this._moveSpeed[0]=0,this._moveSpeed[1]=0},i.prototype.stopMove=function(){this.clearMoveData(),this.standAct()},i.prototype.updateMove=function(e){if(this._moving){this.x+=this._moveSpeed[0]*e,this.y+=this._moveSpeed[1]*e;var i=t.VectorUtil.calcLength(this._moveTarPos[0]-this.x,this._moveTarPos[1]-this.y);i<this._speed*e&&(this.x=this._moveTarPos[0],this.y=this._moveTarPos[1],this.clearMoveData(),this.standAct())}},i.prototype.setFlipX=function(t){this._sprite.scaleX=t?-this._spriteScale:this._spriteScale},i.prototype.adjustDir=function(e,i){var r=e-this.x,o=i-this.y;(0!=r||0!=o)&&(r>0?(0>o?this._dir=t.ActorDir.AD_EASTNORTH:this._dir=t.ActorDir.AD_EASTSOUTH,this.setFlipX(!1)):(0>o?this._dir=t.ActorDir.AD_WESTNORTH:this._dir=t.ActorDir.AD_WESTSOUTH,this.setFlipX(!0)))},i.prototype.playSpAct_STAND=function(t){this.standAct()},i.prototype.playSpAct=function(e){var i=e.type,r=e.data;e.param;switch(i){case t.ActorSpActType.ASAT_STAND:this.playSpAct_STAND(r)}},i.prototype.addSpAct=function(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this._spActs.push({time:t,type:e,data:i,param:r})},i.prototype.updateSpAct=function(t){for(var e in this._spActs){var i=this._spActs[e];i.time=i.time-t}for(var e in this._spActs){var i=this._spActs[e];if(i.time<=0){this._spActs.splice(e,1),this.playSpAct(i);break}}},i.prototype.clearSpAct=function(){this._spActs=[]},i.prototype.execSkill=function(e,i){this.attackAct(),this._actorSt.setNextState(t.ActorStType.AST_ATTACK,{state_tick:this.getCurActStTime()});var r=i.result;if(r.result==t.AttackResult.SUCCESS){var o=this._mapLayer.query(t.IMapCmdQ.IMCQ_GetActor,[i.target]);o.hp-=r.damage,o.refreshHpBar();var n=-180;this._mapLayer.notify(t.IMapCmdN.IMCN_CreateNum,[o.x,o.y+n,0,r.damage]),o.mainPlayer&&t.IntfcProxy.getLocalMsgDispatcher().dispatchMsg(t.ILocalMsg.ILM_Player_ChangeHp,{hp:o.hp,maxHp:o.maxHp})}},i}(t.Entity);t.Actor=e,__reflect(e.prototype,"h5game.Actor")}(h5game||(h5game={}));var h5game;!function(t){var e;!function(t){t[t.ET_PLAYER=1]="ET_PLAYER",t[t.ET_MONSTER=2]="ET_MONSTER",t[t.ET_NPC=3]="ET_NPC"}(e=t.EntityType||(t.EntityType={}));var i;!function(t){t[t.AAS_STANDFRONT=1]="AAS_STANDFRONT",t[t.AAS_STANDBACK=2]="AAS_STANDBACK",t[t.AAS_RUNFRONT=3]="AAS_RUNFRONT",t[t.AAS_RUNBACK=4]="AAS_RUNBACK",t[t.AAS_ATTACKFRONT=5]="AAS_ATTACKFRONT",t[t.AAS_ATTACKBACK=6]="AAS_ATTACKBACK"}(i=t.ActorActionState||(t.ActorActionState={}));var r;!function(t){t[t.AD_EASTSOUTH=1]="AD_EASTSOUTH",t[t.AD_EASTNORTH=2]="AD_EASTNORTH",t[t.AD_WESTSOUTH=3]="AD_WESTSOUTH",t[t.AD_WESTNORTH=4]="AD_WESTNORTH"}(r=t.ActorDir||(t.ActorDir={}));var o;!function(t){t[t.SUCCESS=1]="SUCCESS",t[t.KILLED=2]="KILLED",t[t.MISS=3]="MISS",t[t.NOT_IN_RANGE=4]="NOT_IN_RANGE",t[t.NO_ENOUGH_MP=5]="NO_ENOUGH_MP",t[t.NOT_COOLDOWN=6]="NOT_COOLDOWN",t[t.ATTACKER_CONFUSED=7]="ATTACKER_CONFUSED"}(o=t.AttackResult||(t.AttackResult={}));var n;!function(t){t[t.ASAT_STAND=1]="ASAT_STAND"}(n=t.ActorSpActType||(t.ActorSpActType={}));var a;!function(t){t[t.AST_NORMAL=1]="AST_NORMAL",t[t.AST_ATTACK=2]="AST_ATTACK"}(a=t.ActorStType||(t.ActorStType={}))}(h5game||(h5game={}));var h5game;!function(t){var e=function(){function e(){}return e.actionState2Str=function(e){return e==t.ActorActionState.AAS_STANDFRONT?"standfront":e==t.ActorActionState.AAS_STANDBACK?"standback":e==t.ActorActionState.AAS_RUNFRONT?"runfront":e==t.ActorActionState.AAS_RUNBACK?"runback":e==t.ActorActionState.AAS_ATTACKFRONT?"attackfront":e==t.ActorActionState.AAS_ATTACKBACK?"attackback":"standfront"},e.actStFrmRate=function(e,i){return i==t.ActorActionState.AAS_STANDFRONT||i==t.ActorActionState.AAS_STANDBACK||i==t.ActorActionState.AAS_RUNFRONT||i==t.ActorActionState.AAS_RUNBACK||i==t.ActorActionState.AAS_ATTACKFRONT||i==t.ActorActionState.AAS_ATTACKBACK?12:-1},e}();t.EntityUtil=e,__reflect(e.prototype,"h5game.EntityUtil")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"entityType",{get:function(){return t.EntityType.ET_MONSTER},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i),this._entityId=t.entityId,this._name="mon10001",this._hp=t.hp,this._maxHp=t.maxHp,this._speed=t.walkSpeed,this.x=t.x,this.y=t.y,this.initSprite(),this.initNameLabel(),this.initHpBar(),this.standAct()},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.initSprite=function(){this._sprite=t.IntfcProxy.getMCFtry().create("monster_10001"),this.addChild(this._sprite)},i}(t.Actor);t.Monster=e,__reflect(e.prototype,"h5game.Monster")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"entityType",{get:function(){return t.EntityType.ET_NPC},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i),this._entityId=t.entityId,this._name="npc10001",this.x=t.x,this.y=t.y,this.initSprite(),this.standAct()},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.initSprite=function(){this._sprite=t.IntfcProxy.getMCFtry().create("npc_10001"),this.addChild(this._sprite)},i}(t.Actor);t.Npc=e,__reflect(e.prototype,"h5game.Npc")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),Object.defineProperty(i.prototype,"entityType",{get:function(){return t.EntityType.ET_PLAYER},enumerable:!0,configurable:!0}),i.prototype.init=function(t,i){e.prototype.init.call(this,t,i),this._entityId=t.entityId,this._name=t.name,this._hp=t.hp,this._maxHp=t.maxHp,this._mp=t.mp,this._maxMp=t.maxMp,this._speed=t.walkSpeed,this.x=t.x,this.y=t.y,this.initSprite(),this.initNameLabel(),this.initHpBar(),this.initMpBar(),this.standAct()},i.prototype.release=function(){e.prototype.release.call(this)},i.prototype.initSprite=function(){this._sprite=t.IntfcProxy.getMCFtry().create("player_10002"),this.addChild(this._sprite)},i.prototype.moveTo=function(i,r){e.prototype.moveTo.call(this,i,r),this.mainPlayer&&t.IntfcProxy.getNetMsgHdlr().requestMsg(t.INetMsgReq.INMR_PLAYER_move,{path:[{x:this.x,y:this.y},{x:i,y:r}]},null)},i}(t.Actor);t.Player=e,__reflect(e.prototype,"h5game.Player")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function i(t){var i=e.call(this)||this;return i._actor=null,i._state_tick=0,i._actor=t,i}return __extends(i,e),i.prototype.enterState=function(e,i){e==t.ActorStType.AST_NORMAL?this.enterState_NORMAL(i):e==t.ActorStType.AST_ATTACK&&this.enterState_ATTACK(i)},i.prototype.exitState=function(e,i){e==t.ActorStType.AST_NORMAL?this.exitState_NORMAL(i):e==t.ActorStType.AST_ATTACK&&this.exitState_ATTACK(i)},i.prototype.updateState=function(e){this.cur_state==t.ActorStType.AST_NORMAL?this.updateState_NORMAL(e):this.cur_state==t.ActorStType.AST_ATTACK&&this.updateState_ATTACK(e)},i.prototype.enterState_NORMAL=function(t){},i.prototype.exitState_NORMAL=function(t){},i.prototype.updateState_NORMAL=function(t){},i.prototype.enterState_ATTACK=function(t){this._state_tick=t.state_tick},i.prototype.exitState_ATTACK=function(t){this._actor.standAct()},i.prototype.updateState_ATTACK=function(e){this._state_tick-=e,this._state_tick<0&&this.setNextState(t.ActorStType.AST_NORMAL,null)},i}(t.BaseState);t.ActorState=e,__reflect(e.prototype,"h5game.ActorState")}(h5game||(h5game={}));