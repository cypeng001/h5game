var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},h5game;!function(t){var e=function(e){function n(n,i,o){var r=e.call(this,n)||this;return r._pool=null,r._mcDatas={},r.mcst=t.MCST.LOAD,r._key=i,r._pool=o,r}return __extends(n,e),n.prototype.gotoAndPlay=function(n,i){void 0===i&&(i=0),this.mcst==t.MCST.LOAD&&e.prototype.gotoAndPlay.call(this,n,i)},n.prototype.gotoAndStop=function(n){this.mcst==t.MCST.LOAD&&e.prototype.gotoAndStop.call(this,n)},n.prototype.playAnimation=function(e,n){if(void 0===n&&(n=0),this.mcst==t.MCST.LOAD){if(this._pool.getMCDataCnt()>1){var i=this._mcDatas[e];i||(i=this._mcDatas[e]=this._pool.createMovieClipData(this._key+"_"+e)),this.movieClipData=i}this.gotoAndPlay(e,n)}},n}(egret.MovieClip);t.MCAdv=e,__reflect(e.prototype,"h5game.MCAdv")}(h5game||(h5game={}));var h5game;!function(t){var e=function(){function t(){this._configMap={},this._manifest=null}return t.prototype.init=function(){var t=new JSZip(RES.getRes("movieclip_zip"));this.initManifest(t),this.initMCCnf(t),RES.destroyRes("movieclip_zip")},t.prototype.initManifest=function(t){var e=JSON.parse(t.file("manifest.json").asText());this._manifest=e},t.prototype.initMCCnf=function(t){for(var e in this._manifest){var n=this.getFilelist(e);for(var i in n){var o=n[i],r=JSON.parse(t.file(o+".json").asText());this.regMCCnf(o,r)}}},t.prototype.regMCCnf=function(t,e){return e?this._configMap[t]?(console.warn("MCCnfMgr_regMCCnf config already exist",t),!1):(this._configMap[t]=e,!0):(console.warn("MCCnfMgr_regMCCnf config is null",t),!1)},t.prototype.getMCCnf=function(t){var e=this._configMap[t];return e||console.warn("MCCnfMgr_getMCCnf config is null",t),e},t.prototype.getHash=function(t,e){var n=this._manifest[t].crc,i=this._manifest[t].files;for(var o in i)if(i[o]==e)return n[o];return""},t.prototype.getHashByIndex=function(t,e){return this._manifest[t].crc[e]},t.prototype.getFilelist=function(t){return this._manifest[t].files},t}();t.MCCnfMgr=e,__reflect(e.prototype,"h5game.MCCnfMgr")}(h5game||(h5game={}));var h5game;!function(t){var e;!function(t){t[t.UNINIT=1]="UNINIT",t[t.LOAD=2]="LOAD",t[t.UNLOAD=3]="UNLOAD"}(e=t.MCST||(t.MCST={}));var n;!function(t){t[t.UNINIT=1]="UNINIT",t[t.UNLOAD=2]="UNLOAD",t[t.LOADING=3]="LOADING",t[t.LOADED=4]="LOADED"}(n=t.MCPST||(t.MCPST={}))}(h5game||(h5game={}));var h5game;!function(t){var e=function(t){function e(e,n){return t.call(this,e,n)||this}return __extends(e,t),e.prototype.setTexture=function(e){if(t.prototype.setTexture.call(this,e),this.enableCache)for(var n in this.$mcDataCache){var i=this.$mcDataCache[n];i.spriteSheet=this.$spriteSheet}},e}(egret.MovieClipDataFactory);t.MCDataFtryAdv=e,__reflect(e.prototype,"h5game.MCDataFtryAdv")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function n(i,o){var r=e.call(this,i)||this;return r._state=t.MCPST.UNINIT,r._mcDataFtrys=null,r._mcDataCnt=0,r._mcCnfMgr=null,r._loadFileCnt=0,r._mcCnfMgr=o,r._autoRecycleInterval=n.DEF_AUTO_RECYCLE_INTERVAL,r._state=t.MCPST.UNLOAD,r}return __extends(n,e),n.getAssets=function(t,e){var n=egret.getImplementation("eui.IAssetAdapter");n.getAsset(t,function(t){e(t)},this)},n.prototype.getImagePath=function(t){return RES.config.resourceRoot+"movieclip/"+t+".png"},n.prototype.createObj=function(e,n){var i=null;return 1==this.getMCDataCnt()&&(i=this._mcDataFtrys[e].generateMovieClipData(e)),new t.MCAdv(i,e,this)},n.prototype.recycleObj=function(t){var e=t;e.clearEventListener()},n.prototype.releaseObj=function(t){var e=t;e.clearEventListener()},n.prototype.reload=function(t,e){this._mcDataFtrys[t].texture=e},n.prototype.create=function(n,i){void 0===i&&(i=null),this._lastActiveTick=egret.getTimer();var o=this._mcCnfMgr.getFilelist(n);if(!this._mcDataFtrys){this._mcDataFtrys={};for(var r in o){var a=o[r];this._mcDataFtrys[a]=new t.MCDataFtryAdv(this._mcCnfMgr.getMCCnf(a)),this._mcDataCnt++}}return this._state==t.MCPST.UNLOAD&&(this._state=t.MCPST.LOADING,this.loadNext()),e.prototype.create.call(this,n,i)},n.prototype.loadNext=function(){var t=this._name,e=this._mcCnfMgr.getFilelist(t),i=e[this._loadFileCnt],o=this.getImagePath(e[this._loadFileCnt]),r=this._mcCnfMgr.getHashByIndex(t,this._loadFileCnt);r&&r.length>0&&(o+="?v="+r);var a=this;n.getAssets(o,function(t){egret.callLater(function(){a._loadFileCnt++,a.reload(i,t),a._loadFileCnt==e.length?a.loadComplete():a.loadNext()},a)})},n.prototype.loadComplete=function(){this._state=t.MCPST.LOADED;for(var e in this._actPool){var n=this._actPool[e];n.mcst==t.MCST.UNLOAD&&(n.mcst=t.MCST.LOAD)}},n.prototype.release=function(){e.prototype.release.call(this);var t=this._mcCnfMgr.getFilelist(this._name);for(var n in t){var i=t[n],o=this.getImagePath(i);RES.destroyRes(o)}this._mcDataFtrys=null,this._mcCnfMgr=null},n.prototype.canRelease=function(){return 0==this._actPool.length&&egret.getTimer()-this._lastActiveTick>n.DEF_RELEASE_TIME},n.prototype.getMCDataCnt=function(){return this._mcDataCnt},n.prototype.createMovieClipData=function(t){return this._mcDataFtrys[t].generateMovieClipData(t)},n.DEF_RELEASE_TIME=6e4,n.DEF_AUTO_RECYCLE_INTERVAL=5e3,n}(t.ObjPool);t.MCPool=e,__reflect(e.prototype,"h5game.MCPool")}(h5game||(h5game={}));var h5game;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._init=!1,t._mcCnfMgr=null,t}return __extends(n,e),n.prototype.init=function(){return this._init?void console.warn("MCFtry already init"):(this._init=!0,this._mcCnfMgr=new t.MCCnfMgr,void this._mcCnfMgr.init())},n.prototype.createPool=function(e){return new t.MCPool(e,this._mcCnfMgr)},n}(t.ObjFtry);t.MCFtry=e,__reflect(e.prototype,"h5game.MCFtry")}(h5game||(h5game={}));